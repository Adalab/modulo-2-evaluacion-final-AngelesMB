"use strict";const searchElem=document.querySelector(".js-search"),containerElem=document.querySelector(".js-container"),favContainerElem=document.querySelector(".js-favContainer"),searchButton=document.querySelector(".js-searchButton"),resetButton=document.querySelector(".js-resetButton"),APIPath="https://api.jikan.moe/v3/search/anime?q=";let showsArray=[],favShowsArray=[],searchValue="";function getSearchValue(){searchValue=searchElem.value.toLowerCase()}function renderTitle(e,t){const a=document.createElement("h4"),r=document.createTextNode(t.title);a.classList.add("preview--title"),a.appendChild(r),e.appendChild(a)}function renderImage(e,t,a){const r=document.createElement("div");r.classList.add("preview--image"),e.appendChild(r),r.setAttribute("style",`background-image:url(${t.image_url})`),renderSynopsis(e,t,r,a)}function renderSynopsis(e,t,a,r){const n=document.createElement("p"),o=document.createTextNode(t.synopsis);n.classList.add("preview--synopsis","hidden"),n.appendChild(o),a.appendChild(n),r.appendChild(e)}function checkIfFavorite(e){if(favShowsArray!==[]){const t=favShowsArray.find(t=>t.mal_id===e.mal_id);if(void 0!==t){const e=document.querySelectorAll(".show--preview"),a=Array.from(e);for(const e of a)parseInt(e.dataset.id)===t.mal_id&&e.classList.add("favorite")}}}function renderErrorMessage(){const e=document.createElement("p"),t=document.createTextNode("No hemos encontrado resultados con esa bÃºsqueda.");e.appendChild(t),containerElem.appendChild(e)}function renderShows(){for(const e of showsArray){const t=document.createElement("div");t.classList.add("show--preview"),t.setAttribute("data-id",e.mal_id),renderTitle(t,e),renderImage(t,e,containerElem),t.addEventListener("click",handleShowClick),checkIfFavorite(e)}}function renderResults(){containerElem.innerHTML="",0===showsArray.length?renderErrorMessage():renderShows()}function getDataApi(){fetch(APIPath+searchValue).then(e=>e.json()).then(e=>{showsArray=e.results,renderResults()})}function handleSearchButtonClick(e){e.preventDefault(),getSearchValue(),""===searchValue?containerElem.innerHTML="Venga, busca algo.":searchValue.length<3?containerElem.innerHTML="Introduce al menos 3 caracteres.":getDataApi()}function setAsFavorite(e){e.currentTarget.classList.toggle("favorite")}function setAsNotFavorite(e){if(0!==showsArray.length){const t=document.querySelectorAll(".favorite"),a=Array.from(t).find(t=>parseInt(t.dataset.id)===e);void 0!==a&&a.classList.remove("favorite")}}function removeFavFromArray(e){const t=parseInt(e.currentTarget.parentNode.dataset.id),a=favShowsArray.findIndex(e=>e.mal_id===t);favShowsArray.splice(a,1),setAsNotFavorite(t)}function handleRemoveFavClick(e){removeFavFromArray(e),saveToLS(),renderFavList()}function renderRemoveFavIcon(e){const t=document.createElement("div");t.classList.add("fav--remove__icon"),t.addEventListener("click",handleRemoveFavClick),e.appendChild(t)}function handleResetButtonFavClick(){favShowsArray=[],saveToLS(),renderFavList(),renderResults()}function renderResetButtonFav(){const e=document.createElement("input");e.setAttribute("type","reset"),e.setAttribute("value","Limpiar favoritos"),e.classList.add("main--buttonFav"),e.addEventListener("click",handleResetButtonFavClick),favContainerElem.appendChild(e)}function renderFavList(){if(favContainerElem.innerHTML="",0!==favShowsArray.length){renderResetButtonFav();for(const e of favShowsArray){const t=document.createElement("div");t.classList.add("show--preview__fav"),t.setAttribute("data-id",e.mal_id),renderTitle(t,e),renderImage(t,e,favContainerElem),renderRemoveFavIcon(t)}}}function saveToLS(){localStorage.setItem("favShowsArrayLS",JSON.stringify(favShowsArray))}function saveAsFavorite(e){const t=parseInt(e.currentTarget.dataset.id),a=showsArray.find(e=>e.mal_id===t),r=favShowsArray.findIndex(e=>e.mal_id===t);e.currentTarget.classList.contains("favorite")?favShowsArray.push(a):favShowsArray.splice(r,1),saveToLS()}function handleShowClick(e){setAsFavorite(e),saveAsFavorite(e),renderFavList()}function handleResetButtonClick(){showsArray=[],containerElem.innerHTML=""}function getDataLS(){const e=JSON.parse(localStorage.getItem("favShowsArrayLS"));null!==e&&(favShowsArray=e,renderFavList())}getDataLS(),searchButton.addEventListener("click",handleSearchButtonClick),resetButton.addEventListener("click",handleResetButtonClick);