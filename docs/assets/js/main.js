"use strict";const containerElem=document.querySelector(".js-container"),favContainerElem=document.querySelector(".js-favContainer"),APIPath="https://api.jikan.moe/v3/search/anime?q=";let showsArray=[],favShowsArray=[],searchValue="";function startApp(){getDataLS();const e=document.querySelector(".js-searchButton"),t=document.querySelector(".js-resetButton");addListener(e,handleSearchButtonClick),addListener(t,handleResetButtonClick)}function getDataLS(){const e=JSON.parse(localStorage.getItem("favShowsArrayLS"));null!==e&&(favShowsArray=e,renderFavList())}function handleSearchButtonClick(e){e.preventDefault(),showsArray=[],getSearchValue(),""===searchValue?renderErrorMessage("Venga, busca algo."):searchValue.length<3?renderErrorMessage("Introduce al menos 3 caracteres."):(renderLoadingGif(),getDataApi().then(()=>{0===showsArray.length?renderErrorMessage("No hemos encontrado resultados con esa bÃºsqueda."):renderResults()}))}function handleShowClick(e){renderAsFavorite(e),saveAsFavorite(e),saveToLS(),renderFavList()}function handleRemoveFavClick(e){removeFavFromArray(e),saveToLS(),renderFavList()}function handleResetButtonFavClick(){favShowsArray=[],saveToLS(),renderFavList(),renderResults()}function handleResetButtonClick(){showsArray=[],containerElem.innerHTML=""}function renderFavList(){if(favContainerElem.innerHTML="",0!==favShowsArray.length){for(const e of favShowsArray)renderShowPreviewFav(e);addListener(renderResetButtonFav(),handleResetButtonFavClick)}}function renderShowPreviewFav(e){const t=document.createElement("div");t.classList.add("show--preview__fav"),t.setAttribute("data-id",e.mal_id),renderTitle(t,e),renderImage(t,e),favContainerElem.appendChild(t);addListener(renderRemoveFavIcon(t),handleRemoveFavClick)}function renderTitle(e,t){const r=document.createElement("h4"),n=document.createTextNode(t.title);r.classList.add("preview--title"),r.appendChild(n),e.appendChild(r)}function renderImage(e,t){const r=document.createElement("div");r.classList.add("preview--image");return"https://cdn.myanimelist.net/images/qm_50.gif?s=e1ff92a46db617cb83bfc1e205aff620"===t.image_url?r.setAttribute("style",'background-image:url("./assets/images/placeholderBuscanime.png")'):r.setAttribute("style",`background-image:url(${t.image_url})`),e.appendChild(r),r}function renderSynopsis(e,t){const r=document.createElement("p"),n=document.createTextNode(t.synopsis);r.classList.add("preview--synopsis","hidden"),r.appendChild(n),e.appendChild(r)}function renderRemoveFavIcon(e){const t=document.createElement("i");return t.classList.add("far","fa-times-circle","fav--remove__icon"),e.appendChild(t),t}function addListener(e,t){e.addEventListener("click",t)}function renderResetButtonFav(){const e=document.createElement("input");return e.setAttribute("type","reset"),e.setAttribute("value","Limpiar favoritos"),e.classList.add("main--buttonFav"),favContainerElem.appendChild(e),e}function getSearchValue(){const e=document.querySelector(".js-search");searchValue=e.value.toLowerCase()}function renderErrorMessage(e){containerElem.innerHTML="";const t=document.createElement("p");t.classList.add("container--shows__error");const r=document.createTextNode(e);t.appendChild(r),containerElem.appendChild(t)}function renderLoadingGif(){containerElem.innerHTML="";const e=document.createElement("img");e.classList.add("container--shows__loading"),e.src="./assets/images/loading.gif",containerElem.appendChild(e)}function getDataApi(){return fetch(APIPath+searchValue).then(e=>e.json()).then(e=>{showsArray=e.results.map(e=>createShowObject(e))})}function createShowObject(e){const t={};return t.mal_id=e.mal_id,t.title=e.title,t.image_url=e.image_url,t.synopsis=e.synopsis,t}function renderResults(){containerElem.innerHTML="",renderShows()}function renderShows(){for(const e of showsArray){const t=renderContainer(e);renderTitle(t,e),renderImage(t,e),renderSynopsis(t,e),containerElem.appendChild(t),addListener(t,handleShowClick),checkIfFavorite(e,t)}}function renderContainer(e){const t=document.createElement("div");return t.classList.add("show--preview"),t.setAttribute("data-id",e.mal_id),t.addEventListener("mouseover",handleImgMouseover),t.addEventListener("mouseleave",handleImgMouseleave),t}function handleImgMouseover(e){const t=e.currentTarget,r=t.querySelector(".preview--image"),n=t.querySelector(".preview--synopsis");r.classList.add("opaque"),n.classList.remove("hidden")}function handleImgMouseleave(e){const t=e.currentTarget,r=t.querySelector(".preview--image"),n=t.querySelector(".preview--synopsis");r.classList.remove("opaque"),n.classList.add("hidden")}function checkIfFavorite(e,t){void 0!==favShowsArray.find(t=>t.mal_id===e.mal_id)&&t.classList.add("favorite")}function renderAsFavorite(e){e.currentTarget.classList.toggle("favorite")}function saveAsFavorite(e){const t=parseInt(e.currentTarget.dataset.id),r=findIdInArray(showsArray,t),n=findIndexIdInArray(favShowsArray,t);e.currentTarget.classList.contains("favorite")?favShowsArray.push(r):favShowsArray.splice(n,1)}function findIdInArray(e,t){return e.find(e=>e.mal_id===t)}function findIndexIdInArray(e,t){return e.findIndex(e=>e.mal_id===t)}function saveToLS(){localStorage.setItem("favShowsArrayLS",JSON.stringify(favShowsArray))}function removeFavFromArray(e){const t=parseInt(e.currentTarget.parentNode.dataset.id),r=findIndexIdInArray(favShowsArray,t);favShowsArray.splice(r,1),setAsNotFavorite(t)}function setAsNotFavorite(e){if(0!==showsArray.length){const t=document.querySelectorAll(".favorite"),r=Array.from(t).find(t=>parseInt(t.dataset.id)===e);void 0!==r&&r.classList.remove("favorite")}}startApp();